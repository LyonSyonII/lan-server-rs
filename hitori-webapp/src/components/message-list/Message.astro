---
import type { Message as MessageProps } from './MessageListElement'
import { Marked } from "marked";
import { markedHighlight } from "marked-highlight";
import hljs from "highlight.js";

type Props = MessageProps;

const { date, text } = Astro.props;

const marked = new Marked(
  markedHighlight({
    langPrefix: "hljs language-",
    highlight(code, lang) {
      const language = hljs.getLanguage(lang) ? lang : "plaintext";
      console.log({lang, language});
      return hljs.highlight(code, { language }).value;
    }
  })
)

const html = await marked.parse(text, { breaks: true });
---
<x-message>
  <p>{date.toLocaleString()}</p>
  <div set:html={html} />
</x-message>

<style>
  div > :global(:first-child) {
    margin-top: 0;
  }
  p {
    color: #949ba4;
    font-size: small;
    margin: 0;
  }
</style>

<script>
  import { MessageElement } from "./MessageElement";
  
  customElements.define("x-message", MessageElement);
</script>